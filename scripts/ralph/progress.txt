# Ralph Progress Log
Started: Initial setup
---

## Codebase Patterns
- Ralph runs Claude Code in autonomous mode with `--dangerously-skip-permissions`
- Each iteration reads prd.json, picks the next incomplete story, implements it, and commits
- Progress is tracked via git commits, prd.json updates, and this file
- This is a vanilla JS single-page app in public/index.html - no build system, no tests
- The `isPro` variable controls Pro features; stored in localStorage as `invoiceflow_pro`
- STRIPE_CONFIG at top of script holds payment link URLs for easy updates
- Use `new Function(code)` to check JavaScript syntax since there's no build/typecheck
- Template system: `currentTemplate` state tracks selection, CSS uses `.invoice-preview.template-{name}`, PDF uses conditionals
---

## 2026-01-11 - US-001
- Implemented Stripe Payment Links integration
- Files changed: public/index.html
- **Learnings for future iterations:**
  - All code is in a single index.html file with inline JavaScript
  - The `isPro` global variable tracks Pro status, set from `localStorage.getItem('invoiceflow_pro')`
  - `checkProStatus()` updates the UI badge in header when Pro is active
  - URL parameters are handled at page load in `handleProUrlParams()`
  - The `checkout()` function redirects to Stripe Payment Links, no need for Stripe SDK
---

## 2026-01-11 - US-002
- Verified watermark removal for Pro users (already implemented)
- Files changed: None (verification only)
- **Learnings for future iterations:**
  - Preview watermark logic is in `renderPreview()` function (line ~1440): uses ternary `isPro ? '' : '<div class="invoice-footer">...'`
  - PDF watermark logic is in `downloadPDF()` function (line ~1713): `if (!isPro)` check before adding watermark
  - Both conditionally hide watermark based on global `isPro` variable
  - No code changes needed - the watermark removal feature was implemented alongside US-001
---

## 2026-01-11 - US-003
- Implemented Modern Dark template for Pro users
- Files changed: public/index.html
- **Learnings for future iterations:**
  - Added `currentTemplate` state variable to track selected template
  - Template CSS classes follow pattern `.invoice-preview.template-{name}` (e.g., `.template-modern-dark`)
  - Preview applies template by adding class to `#invoicePreview` element in `renderPreview()`
  - PDF uses `isModernDark = currentTemplate === 'modern'` to switch color schemes
  - PDF for dark templates: fill entire page with background, use inverted color palette
  - `updateTemplateSelector()` removes `.pro` class from template options when user is Pro
  - `selectTemplate()` gates Pro templates with isPro check before allowing selection
  - Free users see PRO badge via CSS `.template-option.pro::after` pseudo-element
---

## 2026-01-11 - US-004
- Implemented Minimal template for Pro users
- Files changed: public/index.html
- **Learnings for future iterations:**
  - Minimal template uses `.template-minimal` CSS class following same pattern as Modern Dark
  - Key styling: thin `1px solid` lines, `font-weight: 300-400`, subtle gray palette
  - PDF uses `isMinimal = currentTemplate === 'minimal'` for conditional formatting
  - PDF Minimal differences: no filled backgrounds for table headers, lowercase column labels, no bold fonts
  - Preview template class logic already wired up from US-003 (`renderPreview()` line ~1654)
  - Pro template gating handled centrally in `selectTemplate()` via `isProTemplate` check
---

## 2026-01-11 - US-005
- Made template selector fully functional with persistence
- Files changed: public/index.html
- **Learnings for future iterations:**
  - CRITICAL: Initialization order matters - `checkProStatus()` must be called BEFORE `loadSavedData()`
  - Template is stored in localStorage under `invoiceData.template` alongside other invoice fields
  - `loadSavedData()` restores template selection and updates both `currentTemplate` state and UI `.active` class
  - Pro template restoration checks `isPro` - if user lost Pro status, they're reset to classic template
  - `selectTemplate()` handles: Pro gating, state update, UI active class, and calls `renderPreview()`
---

## 2026-01-11 - US-006
- Implemented logo upload functionality for Pro users
- Files changed: public/index.html
- **Learnings for future iterations:**
  - Logo stored as base64 data URL in `logoDataUrl` global variable
  - Logo persisted in localStorage under `invoiceData.logo`
  - `handleLogoUpload()` validates file type (PNG/JPG) and size (500KB max)
  - `updateLogoPreview()` toggles between upload UI and preview UI with remove button
  - `updateLogoUploadSection()` removes `.locked` class for Pro users (called from `checkProStatus()`)
  - Pro gating pattern: section has `.locked` class by default, CSS shows PRO badge via `::after`
  - Section click handler `handleLogoSectionClick()` opens Pro modal for free users
  - Logo restoration in `loadSavedData()` only happens if `isPro` is true
---

## 2026-01-11 - US-007
- Implemented logo display in preview and PDF export
- Files changed: public/index.html
- **Learnings for future iterations:**
  - Preview logo: Added `.invoice-header-left` flex container with `.invoice-logo` inside `renderPreview()`
  - Preview logo uses CSS: `max-width: 150px`, `max-height: 60px`, `object-fit: contain`
  - PDF logo: Uses jsPDF `addImage()` with base64 data URL in `downloadPDF()`
  - PDF logo sizing: max 35mm width, 15mm height, maintains aspect ratio via calculation
  - PDF image format detection: checks if data URL contains 'image/png' else uses 'JPEG'
  - Logo positioning in PDF shifts title via `titleStartX` variable
  - Must await image load before getting dimensions in PDF (uses `new Image()` and Promise)
  - Logo only shown if `logoDataUrl && isPro` - gated by Pro status
---
